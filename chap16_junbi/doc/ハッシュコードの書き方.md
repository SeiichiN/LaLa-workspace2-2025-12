<style>
.my-text {
background-color: #f5f5f5;
padding: 10px;
margin-left: 30%;
}
</style>

<div class="my-text">
以下のコードは、equal()とhashCode()をオーバーライドしています。

```
import java.util.HashSet;
import java.util.Objects;

class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Person)) return false;
        Person p = (Person) o;
        return Objects.equals(this.name, p.name);
    }

    @Override
    public int hashCode() {
        return Objects.hash(name);
    }
}
```
これは、次のようにも書けると思うのですが、どうでしょうか？

```
import java.util.HashSet;
import java.util.Objects;

class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Person)) return false;
        Person p = (Person) o;
        return this.name.equals(p.name);
    }

    @Override
    public int hashCode() {
        return this.name.hashCode();
    }
}
```
</div>

---

はい、その書き方も **問題なく正しく動作します。**

---

# ■ 2つの書き方の違い

比較してみると、次の違いがあります。

---

## ① `Objects.equals()` を使うバージョン（安全）

```java
return Objects.equals(this.name, p.name);
```

これは **null に安全（Null Safe）** です。

* name が null の場合
  → `Objects.equals(null, p.name)` は自動的に false
  → NullPointerException は起きない

---

## ② `this.name.equals(p.name)` を使うバージョン（やや注意）

```java
return this.name.equals(p.name);
```

こちらは、**this.name が null のとき NPE が出ます**。

つまり：

| this.name | p.name   | 動作          |
| --------- | -------- | ----------- |
| `"Taro"`  | `"Taro"` | true        |
| `"Taro"`  | null     | false       |
| null      | `"Taro"` | **NPE（危険）** |
| null      | null     | **NPE（危険）** |

---

# ■ hashCode のほうも同じ

### Objects.hash(name)

```java
return Objects.hash(name);
```

* null でも OK（null の hash は 0）
* 多少遅いが安全

### this.name.hashCode()

```java
return this.name.hashCode();
```

* name が null だと NPE
* パフォーマンスは速い

---

# ■ 結論

### ✔ あなたが書いた後者のコードも **正しく動作する**

### ✘ ただし **name が null になる可能性があるなら危険**

---

# ■ ベストプラクティス

* null を絶対に許容しないなら：
  → **後者（直接 equals/hashCode）で OK**

* null の可能性が少しでもあるなら：
  → **Objects.equals() / Objects.hash() を使うほうが安全**

---

必要なら、「null を許さない設計」や「どういうときに NPE が起きるか」の追加コード例も作れます！





<!-- 修正時刻: Wed 2025/12/10 21:46:46 -->

