GameManager設計

GameManagerクラス
  マップの情報を管理する。
  モンスターとの戦いを管理する。
  ゲームの終了処理をする。

GameManagerクラスをインスタンス化し、
プレイヤーインスタンスのフィールドにセットする。
このことにより、プレイヤーからマップ情報へのアクセスが
容易となる。


マップの設計

char型の二次元配列とする。
'.' -- 何もない
'g' -- ゴブリン
's' -- スライム
'p' -- ポーション
1つの場所に複数の char は置けない。

プレイヤーはマップ配列の中には入れない。
マップの中のchar文字を上書きしないかどうかという心配なしに、
自由に移動するためである。

(モンスターの登場のさせ方)
char型のマップの場合、モンスターの登場のさせ方に次の2通りがある。

(1) 'g' に出会ったら、new Goblin() として、ゴブリンインスタンスを
  生成し、それと戦うという方法。
  この場合、戦いを中断してプレイヤーが移動して、また元の場所に
  戻った場合、さっきのゴブリンインスタンスは消滅して、また別の
  ゴブリンインスタンスと戦うということになる。
  それが嫌なら、戦いの中断ができないようにすればよい。
  今回は、戦いの中断ができるようにする。したがって、戦いを中断
  した場合は、そのモンスターの情報は失われる。

(2) たとえば ゴブリンインスタンスをあらかじめ生成しておいて、
  GameManagerインスタンスに保持させておく。そして、'g' と
  出会ったら、そのゴブリンインスタンスと戦うという方法。
  これだと、戦いの中断は簡単にできる。元の場所に戻ったら、
  さっきのゴブリンインスタンスと戦いの続きをすることができる。
  ただ、モンスターの数が増えてくると、管理が大変になる。

今回は (1) の方法でいく。  

GameManagerクラス

フィールド
  YSIZE       :int         マップの縦の大きさ
  XSIZE       :int         マップの横の大きさ
  map         :char[][]    マップ
  numMonsters :int         マップの中のモンスターの数。
  defeatedMonsters :int    倒したモンスターの数。

コンストラクタ
  GameManager(y:int, x:int)
          YSIZE, XSIZE を任意のサイズで初期化する。
          mapを生成する。
          mapを初期化する。
  GameManager()
          YSIZE, XSIZE を 5 に初期化する。


メソッド
  initMap() :void
          縦YSIZE、横XSIZE のマス目に '.' をセットする。
          これはコンストラクタから呼び出すようにしておくと、
          必ず実行される。
  setPosition(char) :void
          char型の文字をマップの中に文字をランダムにセットする。
          重複配置はしない。
  setMonster(char) :void
          setPosition(char)を実行する。
          numMonsters を 1 増やす。
  setItem(char) :void
          setPosition(char)を実行する。
          (setMonster()を作成したので、バランスをとるため、このメソッドを作成)
  printMap(Player) :void
          マップを表示する。プレイヤーは '@' で表示する。
  attackAndReturn(Player, Monster) :void
          1回のターンを表すメソッド。
          簡略化のため、プレイヤーからの攻撃とする。(プレイヤクラス
          の attack()メソッドを呼び出す)
          もし、モンスターが倒れたら、defeatedMonstersの数を1増やし、
          マップ上も '.' に変更する。
          モンスターが倒れなかった場合、モンスターからの反撃となる。
          (モンスタークラスの attack()メソッド)
          その反撃によりプレイヤーが倒れたら、ゲームオーバーとなる。
  battleInfo(Player, Monster) :void
          プレイヤーとモンスターの HP を表示する。
  battle(Player) :void
          プレイヤーの位置から char文字を読み取り、そのモンスターを
          呼び出す(インスタンスを生成する)。
          attackAndReturn(Player, Monster)を呼び出す。
          battlaInfo(Player, Monster)を呼び出す。
          1ターンごとにユーザーに戦いを継続するか、逃げるかが選択
          できる。
          逃げた場合、現在のモンスターはメモリから消滅する。
          再度、この位置に来た場合、新しいモンスターインスタンスが
          生成される。
  isEndCheck() :boolean
          ゲームが終了状態かどうかをチェックする。具体的には、倒した
          モンスターの数(defeatedMonsters)をチェックして、
          numMonstersと同じであれば"終了"、つまり true とする。
  gameOber() :void
          ゲームオーバーの文字を画面に表示する。
          プログラムを終了させる。





;; 修正時刻: Sun 2025/11/23 05:46:00
